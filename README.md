# Danmaku STG 仕様書

## 1. ファイル情報
- **ファイル名:** `danmaku_stg.html`
- **技術スタック:** HTML5, CSS3, JavaScript (ES6+), Canvas API
- **概要:** ブラウザで動作する、ネオン・サイバーテイストの縦スクロール弾幕シューティングゲーム。

## 2. ゲーム概要
- **タイトル:** Neon Danmaku STG (仮)
- **コンセプト:**
    - ネオンカラーのビジュアルと残像効果。
    - ナスカの地上絵風の背景スクロール。
    - 爽快感重視のオートパイロット（デモ）機能。

## 3. 操作方法
- **移動:**
    - **PC:** 矢印キー
    - **マウス/タッチ:** ドラッグした位置へ絶対座標追従（遅延ありで滑らかに移動）
- **攻撃:**
    - **PC:** `Z` キー (押しっぱなしで連射)
    - **マウス/タッチ:** 画面タッチ/クリック中は自動発射
    - **オートモード:** 常時自動発射
- **その他:**
    - **低速移動:** `Shift` キー (PCのみ、当たり判定ドットを表示)
    - **オートモード切替:** `A` キー または画面左上の「AUTO」ボタン

## 4. ゲームシステム詳細

### 4.1. 自機 (Player)
- **ステータス:**
    - `powerLevel`: ショットの強さ (1~3)。
    - `missileTime`: ホーミングミサイルモードの残りフレーム数。
    - `options`: オプション（ビット）の数 (0~2)。
    - `shield`: シールドの枚数 (0~3)。
- **攻撃手段:**
    1.  **メインショット:** 正面へ発射。パワーアップで3way, 5wayに強化。
    2.  **オプションショット:** 緑色のビットから発射される弾。
    3.  **ホーミングミサイル:** シアン色の追尾弾。高い旋回性能と加速力を持つ。
- **オートパイロット (AI):**
    - 敵弾からの回避（斥力）、アイテム回収（引力）、敵への攻撃（軸合わせ）を重み付けして自律移動する。
    - 特にアイテム回収と攻撃を「積極的」に行うようにチューニング済み。

### 4.2. 敵 (Enemy)
- **雑魚 (Normal):**
    - 画面上部から出現し、サイン波などで移動しながら自機狙い弾を撃つ。
- **ボス (Boss):**
    - スコア1000点以上で出現。
    - 耐久力が高く、スパイラル弾幕や全方位弾幕を使用。

### 4.3. アイテム (Item)
敵撃破時に確率でドロップ。自機が一定距離（150px）近づくと加速して吸い寄せられる。
- **P (赤):** パワーアップ (Power)。ショット強化。
- **M (緑):** ミサイル (Missile)。20秒間ミサイル発射モード。
- **S (青):** オプション (Ship/Side)。オプション追加。
- **B (紫):** バリア (Barrier)。シールド追加。

### 4.4. 背景 (Background)
- **クラス:** `NazcaBackground`
- **内容:** ハチドリ、クモ、渦巻きなどのナスカの地上絵風パスデータを描画。
- **演出:** 暗い緑色で描画され、スクロールする。

## 5. コード構造・設計メモ
- **依存関係順序:**
    1. `Bullet` (基底クラス)
    2. `Missile` (Bullet継承)
    3. `Player` (Bullet, Missileを使用)
    4. `Enemy` (Bulletを使用)
    5. `Item`, `Particle`, `NazcaBackground`
- **衝突判定:** `checkCollisions` 関数に集約。
- **ゲームループ:** `loop` 関数で `requestAnimationFrame` を使用。

## 6. 今後の課題・拡張案
- ボスの種類追加、攻撃パターンの多様化。
- ステージ制の導入。
- 音効（BGM, SE）の追加。
